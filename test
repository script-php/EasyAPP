#!/usr/bin/env php
<?php

/**
* @package      Test Runner
* @author       EasyAPP Framework
*/

define('PATH', __DIR__ . DIRECTORY_SEPARATOR);
define('CLI_MODE', true);

// Simple test runner
function runTests($directory = 'tests') {
    $testFiles = glob(PATH . $directory . '/*Test.php');
    
    if (empty($testFiles)) {
        echo "No test files found in {$directory}/\n";
        return false;
    }
    
    $totalPassed = 0;
    $totalFailed = 0;
    
    foreach ($testFiles as $testFile) {
        require_once $testFile;
        
        $className = basename($testFile, '.php');
        
        if (class_exists($className)) {
            $test = new $className();
            $success = $test->run();
            
            if (!$success) {
                $totalFailed++;
            } else {
                $totalPassed++;
            }
        }
    }
    
    echo "\n" . str_repeat("=", 60) . "\n";
    echo "Test Suite Summary\n";
    echo str_repeat("=", 60) . "\n";
    echo "Test files run: " . count($testFiles) . "\n";
    echo "Passed: {$totalPassed}\n";
    echo "Failed: {$totalFailed}\n";
    
    if ($totalFailed > 0) {
        echo "\n❌ Tests failed!\n";
        exit(1);
    } else {
        echo "\n✅ All tests passed!\n";
        exit(0);
    }
}

// Run tests
$directory = isset($argv[1]) ? $argv[1] : 'tests';
runTests($directory);